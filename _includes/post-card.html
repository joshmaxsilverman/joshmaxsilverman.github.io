{%- comment -%}
  Renders a compact post card with badges for kind/theme.
  Expects include.post, include.theme (optional), include.compact (bool).
{%- endcomment -%}
{%- assign card_theme = include.theme | default: include.post.theme | default: "" -%}
{%- assign card_kind = include.post.kind | default: "puzzle" -%}
{%- assign card_source = include.source | default: include.post.source | default: "" -%}
{%- assign post_date = include.post.date | date: "%b %-d, %Y" -%}
{%- comment -%}Normalize deprecated themes into the current set{%- endcomment -%}
{%- assign normalized_theme = card_theme | downcase -%}
{%- case normalized_theme -%}
  {%- when "games-logic" -%}{%- assign normalized_theme = "algorithms" -%}
  {%- when "optimization" -%}{%- assign normalized_theme = "algorithms" -%}
  {%- when "sports" -%}{%- assign normalized_theme = "probability" -%}
  {%- when "seasonal" -%}{%- assign normalized_theme = "probability" -%}
  {%- else -%}{%- assign normalized_theme = normalized_theme -%}
{%- endcase -%}
{%- assign normalized_source = card_source | downcase -%}
{%- unless normalized_source == "fiddler" or normalized_source == "jane-street" or normalized_source == "fivethirtyeight" -%}
  {%- assign normalized_source = "other" -%}
{%- endunless -%}
<a class="post-card" href="{{ include.post.url | relative_url }}" data-kind="{{ card_kind }}" data-theme="{{ normalized_theme | default: 'probability' }}" data-source="{{ normalized_source | default: 'other' }}" data-tags="{{ include.post.tags | join: ' ' | downcase }}">
  <div class="post-card__meta">
    <span class="badge badge--kind">{{ card_kind }}</span>
    {%- if normalized_theme != "" -%}
      <span class="badge badge--theme">{{ normalized_theme }}</span>
    {%- endif -%}
    {%- if card_source != "" -%}
      <span class="badge badge--source">{{ card_source }}</span>
    {%- endif -%}
    <span class="post-card__date">{{ post_date }}</span>
  </div>
  <h3 class="post-card__title">{{ include.post.title }}</h3>
  {%- if include.post.subtitle -%}
    <p class="post-card__subtitle">{{ include.post.subtitle }}</p>
  {%- endif -%}
</a>
